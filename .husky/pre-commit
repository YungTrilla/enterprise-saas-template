#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Enterprise SaaS Template - Pre-commit Quality Gate
# This hook ensures code quality before allowing commits

echo "ğŸ” Running pre-commit quality checks..."

# First run lint-staged for file-specific checks
echo "ğŸ“ Running lint-staged checks..."
pnpm run pre-commit

# Check if lint-staged was successful
if [ $? -ne 0 ]; then
  echo "âŒ Lint-staged checks failed!"
  echo "Please fix the issues above and try again."
  exit 1
fi

# Run comprehensive quality gates (non-strict mode for pre-commit)
echo "ğŸ—ï¸  Running additional quality gates..."
./scripts/quality-gates.sh --staged

# Quality gates return warnings but don't fail pre-commit
# This allows development to continue while highlighting issues
quality_exit_code=$?
if [ $quality_exit_code -ne 0 ]; then
  echo "âš ï¸  Quality gates found issues (warnings only for pre-commit)"
  echo "ğŸ’¡ Run './scripts/quality-gates.sh --staged --strict' to see details"
fi

echo "âœ… Pre-commit checks completed!"
echo "ğŸ“ Commit proceeding..."